<Window x:Class="InvoiceBalanceRefresher.RateLimitingSettingsDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="API Rate Limiting Settings" Height="450" Width="550" 
        WindowStartupLocation="CenterOwner" ResizeMode="NoResize">
    
    <Window.Resources>
        <!-- Reuse existing style resources from MainWindow -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>
        
        <Style x:Key="DescriptionText" TargetType="TextBlock">
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="SettingLabel" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,5,0,5"/>
        </Style>
        
        <Style x:Key="SettingHelp" TargetType="TextBlock">
            <Setter Property="FontStyle" Value="Italic"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <TextBlock Grid.Row="0" Text="API Rate Limiting Configuration" 
                   FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>
        
        <!-- Description -->
        <TextBlock Grid.Row="1" Style="{StaticResource DescriptionText}">
            Configure how the application manages API request rates to prevent overloading the server. 
            Proper rate limiting helps avoid server-side throttling and ensures reliable operation.
        </TextBlock>
        
        <!-- Enable/Disable Checkbox -->
        <CheckBox Grid.Row="2" x:Name="EnableRateLimitingCheckBox" Content="Enable Rate Limiting" 
                  Margin="0,10,0,10" FontWeight="SemiBold" Checked="EnableRateLimitingCheckBox_Changed" 
                  Unchecked="EnableRateLimitingCheckBox_Changed"/>
        
        <!-- Settings Panel -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10,0,10,0">
                <!-- Request Interval Settings -->
                <TextBlock Text="Request Spacing" Style="{StaticResource SectionHeader}"/>
                <TextBlock Style="{StaticResource DescriptionText}">
                    Controls the minimum time between consecutive API requests
                </TextBlock>
                
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Minimum time between requests (ms):" 
                               Style="{StaticResource SettingLabel}"/>
                    <TextBox Grid.Column="1" x:Name="RequestIntervalTextBox" Width="100" 
                             HorizontalAlignment="Left"/>
                </Grid>
                <TextBlock Style="{StaticResource SettingHelp}">
                    Higher values reduce server load but increase total processing time. 
                    Recommended: 300-1000ms depending on server capacity.
                </TextBlock>
                
                <!-- Threshold Settings -->
                <TextBlock Text="Bulk Processing Protection" Style="{StaticResource SectionHeader}"/>
                <TextBlock Style="{StaticResource DescriptionText}">
                    Adds longer pauses after processing many consecutive requests
                </TextBlock>
                
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Request threshold count:" 
                               Style="{StaticResource SettingLabel}"/>
                    <TextBox Grid.Column="1" x:Name="RequestThresholdTextBox" Width="100" 
                             HorizontalAlignment="Left"/>
                </Grid>
                <TextBlock Style="{StaticResource SettingHelp}">
                    How many requests to process before applying a longer cooldown period
                </TextBlock>
                
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Cooldown period (ms):" 
                               Style="{StaticResource SettingLabel}"/>
                    <TextBox Grid.Column="1" x:Name="CooldownPeriodTextBox" Width="100" 
                             HorizontalAlignment="Left"/>
                </Grid>
                <TextBlock Style="{StaticResource SettingHelp}">
                    Length of the cooldown pause after hitting the request threshold
                </TextBlock>
                
                <!-- Rate Limit Response Settings -->
                <TextBlock Text="Rate Limit Response Handling" Style="{StaticResource SectionHeader}"/>
                <TextBlock Style="{StaticResource DescriptionText}">
                    Controls how to react when the server indicates we're sending too many requests
                </TextBlock>
                
                <Grid Margin="0,5,0,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="220"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="429 Retry delay (ms):" 
                               Style="{StaticResource SettingLabel}"/>
                    <TextBox Grid.Column="1" x:Name="RateLimitRetryDelayTextBox" Width="100" 
                             HorizontalAlignment="Left"/>
                </Grid>
                <TextBlock Style="{StaticResource SettingHelp}">
                    How long to wait after receiving a 429 (Too Many Requests) response before retrying
                </TextBlock>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
            <Button Content="Reset to Defaults" Width="130" Height="30" Margin="0,0,10,0" 
                    Click="ResetButton_Click"/>
            <Button Content="Cancel" Width="80" Height="30" Margin="0,0,10,0" 
                    Click="CancelButton_Click"/>
            <Button Content="Save Settings" Width="100" Height="30" 
                    Click="SaveButton_Click"/>
        </StackPanel>
    </Grid>
</Window>