<Window x:Class="InvoiceBalanceRefresher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:InvoiceBalanceRefresher.Converters"
        x:Name="ThisWindow"
        Title="Invoice Balance Refresher" 
        Height="800" Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        BorderThickness="0">

    <Window.InputBindings>
        <!-- Save credentials (Ctrl+S) -->
        <KeyBinding Key="S" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=SaveCredentialsCommand}"/>

        <!-- Open CSV file (Ctrl+O) -->
        <KeyBinding Key="O" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=BrowseCSVCommand}"/>

        <!-- Process single invoice (Ctrl+P) -->
        <KeyBinding Key="P" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=ProcessInvoiceCommand}"/>

        <!-- Process batch (Ctrl+B) -->
        <KeyBinding Key="B" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=ProcessBatchCommand}"/>

        <!-- Clear log (Ctrl+L) -->
        <KeyBinding Key="L" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=ClearLogCommand}"/>

        <!-- Focus search box (Ctrl+F) -->
        <KeyBinding Key="F" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=FocusSearchCommand}"/>

        <!-- Show documentation (F1) -->
        <KeyBinding Key="F1" 
                    Command="{Binding ElementName=ThisWindow, Path=ShowDocumentationCommand}"/>

        <!-- Open credential manager (Ctrl+M) -->
        <KeyBinding Key="M" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=ManageCredentialsCommand}"/>

        <!-- Cycle through credential sets (Ctrl+Tab) -->
        <KeyBinding Key="Tab" Modifiers="Control" 
                    Command="{Binding ElementName=ThisWindow, Path=CycleCredentialSetsCommand}"/>
    </Window.InputBindings>

    <Window.Resources>
        <!-- Custom converters -->
        <converters:OpacityConverter x:Key="OpacityConverter"/>

        <!-- Animation Resources -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
        </Storyboard>
        <Storyboard x:Key="SlideIn">
            <ThicknessAnimation Storyboard.TargetProperty="Margin" From="0,20,0,0" To="0,0,0,0" Duration="0:0:0.3">
                <ThicknessAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </ThicknessAnimation.EasingFunction>
            </ThicknessAnimation>
        </Storyboard>

        <!-- Enhanced Light Mode Colors -->
        <SolidColorBrush x:Key="WindowBackgroundBrush" Color="#F0F4F8"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="ForegroundBrush" Color="#2C3E50"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#D0E1F9"/>
        <SolidColorBrush x:Key="HighlightBrush" Color="#E6F2FF"/>
        <SolidColorBrush x:Key="GroupBackgroundBrush" Color="#F7FAFF"/>
        <SolidColorBrush x:Key="ConsoleBackgroundBrush" Color="#EEF5FF"/>
        <SolidColorBrush x:Key="SeparatorBrush" Color="#CFE2FF"/>

        <!-- Color Scheme -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="#3498DB"/>
        <SolidColorBrush x:Key="PrimaryLightBrush" Color="#5DADE2"/>
        <SolidColorBrush x:Key="SecondaryBrush" Color="#1ABC9C"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#27AE60"/>
        <SolidColorBrush x:Key="AccentAltBrush" Color="#9B59B6"/>
        <SolidColorBrush x:Key="CharcoalBrush" Color="#2C3E50"/>
        <SolidColorBrush x:Key="WarningBrush" Color="#F39C12"/>
        <SolidColorBrush x:Key="ErrorBrush" Color="#E74C3C"/>
        <SolidColorBrush x:Key="SuccessBrush" Color="#2ECC71"/>
        <SolidColorBrush x:Key="InfoBrush" Color="#3498DB"/>

        <!-- Enhanced Mint Green Style -->
        <SolidColorBrush x:Key="MintGreenBrush" Color="#1ABC9C"/>
        <SolidColorBrush x:Key="MintGreenLightBrush" Color="#48C9B0"/>
        <SolidColorBrush x:Key="LavenderBrush" Color="#9B59B6"/>
        <SolidColorBrush x:Key="SoftYellowBrush" Color="#F1C40F"/>
        <SolidColorBrush x:Key="SoftOrangeBrush" Color="#E67E22"/>

        <!-- Text Styles Based on Hierarchy -->
        <Style x:Key="AppTitle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI Light"/>
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Light"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
        </Style>

        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI Semibold"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <Style x:Key="CardTitle" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
        </Style>

        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>

        <Style x:Key="Caption" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Opacity" Value="0.7"/>
        </Style>

        <Style x:Key="StatusText" TargetType="TextBlock">
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="{StaticResource InfoBrush}"/>
        </Style>

        <!-- Control Styles -->
        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
        </Style>

        <!-- Modern Card Style -->
        <Style x:Key="ModernCard" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="15" Direction="270" ShadowDepth="2" Opacity="0.12" Color="#3498DB"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern TextBox -->
        <Style TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource GroupBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TextBox}">
                        <Border x:Name="border" CornerRadius="8" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ScrollViewer x:Name="PART_ContentHost" Focusable="false" Padding="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource PrimaryLightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="BorderThickness" TargetName="border" Value="2"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern Button -->
        <Style TargetType="Button">
            <Setter Property="Background" Value="{StaticResource MintGreenBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="{StaticResource MintGreenBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="border" CornerRadius="8" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding ContentTemplate}" 
                                             Content="{TemplateBinding Content}" HorizontalAlignment="Center" 
                                             VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource MintGreenLightBrush}"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="10" Direction="270" ShadowDepth="2" Opacity="0.2" Color="#1ABC9C"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource MintGreenBrush}"/>
                                <Setter Property="Opacity" Value="0.9"/>
                                <Setter Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="5" Direction="270" ShadowDepth="1" Opacity="0.1" Color="#1ABC9C"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Secondary Button -->
        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource MintGreenBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource MintGreenBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource MintGreenLightBrush}"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                    <Setter Property="Opacity" Value="0.8"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Action Button -->
        <Style x:Key="ActionButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Color="#2ECC71" />
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Effect">
                        <Setter.Value>
                            <DropShadowEffect BlurRadius="10" Direction="270" ShadowDepth="2" Opacity="0.2" Color="#27AE60"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Icon Button -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border x:Name="border" CornerRadius="8" Background="{TemplateBinding Background}">
                            <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding ContentTemplate}" 
                                             Content="{TemplateBinding Content}" HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                                <Setter Property="Opacity" Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Button (alias for default button style) -->
        <Style x:Key="PrimaryButton" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}"/>

        <!-- Modern TabControl -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabControl}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="Transparent" BorderThickness="0" Padding="0,0,0,15">
                                <TabPanel x:Name="HeaderPanel" Panel.ZIndex="1" IsItemsHost="True" 
                                         Background="Transparent" Margin="0"/>
                            </Border>

                            <Border Grid.Row="1" Background="Transparent" BorderThickness="0">
                                <ContentPresenter x:Name="PART_SelectedContentHost" ContentSource="SelectedContent"/>
                            </Border>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern TabItem -->
        <Style TargetType="TabItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Opacity" Value="0.7"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,10"/>
            <Setter Property="Margin" Value="0,0,10,0"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Grid x:Name="templateRoot" SnapsToDevicePixels="True">
                            <Border x:Name="mainBorder" CornerRadius="8" BorderThickness="0" Background="Transparent">
                                <ContentPresenter x:Name="contentPresenter" ContentSource="Header" Focusable="False" 
                                                HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                Margin="{TemplateBinding Padding}"/>
                            </Border>
                            <Border x:Name="selectedBorder" CornerRadius="2" Height="3" Background="{StaticResource MintGreenBrush}" 
                                   Visibility="Collapsed" Margin="10,0,10,0" VerticalAlignment="Bottom"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Opacity" Value="1" TargetName="templateRoot"/>
                                <Setter Property="Visibility" Value="Visible" TargetName="selectedBorder"/>
                                <Setter Property="Background" Value="{StaticResource HighlightBrush}" TargetName="mainBorder"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HighlightBrush}" TargetName="mainBorder"/>
                                <Setter Property="Opacity" Value="0.9" TargetName="templateRoot"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- ComboBox Style -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="{StaticResource GroupBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ComboBox}">
                        <Grid>
                            <Border x:Name="border" CornerRadius="8" Background="{TemplateBinding Background}" 
                                    BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <ContentPresenter x:Name="contentPresenter" ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}" 
                                                    Content="{TemplateBinding SelectionBoxItem}" ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                                                    IsHitTestVisible="False" Margin="{TemplateBinding Padding}"
                                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                    <Path Grid.Column="1" x:Name="arrow" Data="M0,0 L7,0 L3.5,4 z" Fill="{StaticResource ForegroundBrush}" 
                                          Margin="0,0,15,0" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                </Grid>
                            </Border>
                            <Popup x:Name="PART_Popup" AllowsTransparency="True" Grid.ColumnSpan="2" 
                                  IsOpen="{Binding IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}" 
                                  Placement="Bottom" PopupAnimation="Slide">
                                <Border x:Name="dropDownBorder" CornerRadius="8" Background="{StaticResource CardBackgroundBrush}"
                                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" Effect="{TemplateBinding Effect}" Padding="5">
                                    <ScrollViewer SnapsToDevicePixels="True">
                                        <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained"/>
                                    </ScrollViewer>
                                </Border>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource PrimaryLightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsDropDownOpen" Value="true">
                                <Setter Property="BorderBrush" TargetName="border" Value="{StaticResource PrimaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- DataGrid Styles -->
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowBackground" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="AlternatingRowBackground" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="HorizontalGridLinesBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="VerticalGridLinesBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="RowHeight" Value="45"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="SelectionUnit" Value="FullRow"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="CanUserResizeRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource HighlightBrush}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="10,15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridCell}">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}" 
                                SnapsToDevicePixels="True">
                            <ContentPresenter SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" 
                                             VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern ProgressBar -->
        <Style TargetType="ProgressBar">
            <Setter Property="Background" Value="{StaticResource GroupBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{StaticResource MintGreenBrush}"/>
            <Setter Property="Height" Value="6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid>
                            <Border x:Name="PART_Track" Background="{TemplateBinding Background}" CornerRadius="3"/>
                            <Border x:Name="PART_Indicator" Background="{TemplateBinding Foreground}" 
                                    CornerRadius="3" HorizontalAlignment="Left"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern Radio Button -->
        <Style TargetType="RadioButton">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Grid x:Name="templateRoot" Background="Transparent">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border x:Name="radioButtonBorder" BorderBrush="{StaticResource BorderBrush}" BorderThickness="2" 
                                   Background="{StaticResource GroupBackgroundBrush}" CornerRadius="10" 
                                   Width="20" Height="20" VerticalAlignment="Center">
                                <Ellipse x:Name="radioMark" Fill="{StaticResource MintGreenBrush}" Margin="4" 
                                        Opacity="0"/>
                            </Border>
                            <ContentPresenter x:Name="contentPresenter" Grid.Column="1" Margin="10,0,0,0" 
                                            HorizontalAlignment="Left" VerticalAlignment="Center" 
                                            RecognizesAccessKey="True"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Opacity" TargetName="radioMark" Value="1"/>
                                <Setter Property="BorderBrush" TargetName="radioButtonBorder" Value="{StaticResource MintGreenBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="BorderBrush" TargetName="radioButtonBorder" Value="{StaticResource PrimaryLightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- RichTextBox Style -->
        <Style TargetType="RichTextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        <!-- Menu Style -->
        <Style TargetType="Menu">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="FontFamily" Value="Segoe UI"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="0"/>
        </Style>

        <!-- MenuItem Style -->
        <Style TargetType="MenuItem">
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Border x:Name="templateRoot" Background="{TemplateBinding Background}" 
                               BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                               SnapsToDevicePixels="True">
                            <Grid VerticalAlignment="Center">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <ContentPresenter x:Name="Icon" ContentSource="Icon" Margin="4,0,6,0" 
                                                 VerticalAlignment="Center" HorizontalAlignment="Center"/>

                                <ContentPresenter x:Name="menuHeaderPresenter" ContentTemplate="{TemplateBinding HeaderTemplate}" 
                                                 Content="{TemplateBinding Header}" Grid.Column="1" ContentStringFormat="{TemplateBinding HeaderStringFormat}" 
                                                 ContentSource="Header" Margin="{TemplateBinding Padding}" RecognizesAccessKey="True" 
                                                 SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" VerticalAlignment="Center"/>

                                <TextBlock x:Name="menuGestureText" Grid.Column="2" Margin="8,0,8,0" 
                                          Text="{TemplateBinding InputGestureText}" VerticalAlignment="Center" 
                                          Opacity="0.7"/>

                                <Path x:Name="ArrowPath" Grid.Column="3" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                     Data="M0,0 L4,3.5 L0,7 Z" Fill="{TemplateBinding Foreground}" Visibility="Collapsed"/>

                                <Popup x:Name="PART_Popup" AllowsTransparency="True" Focusable="False" 
                                      IsOpen="{Binding IsSubmenuOpen, RelativeSource={RelativeSource TemplatedParent}}" 
                                      PopupAnimation="Fade" Placement="Right">
                                    <Border x:Name="SubMenuBorder" Background="{StaticResource CardBackgroundBrush}" 
                                           BorderBrush="{StaticResource BorderBrush}" BorderThickness="1" Padding="2" 
                                           CornerRadius="4" Effect="{TemplateBinding Effect}">
                                        <ScrollViewer x:Name="SubMenuScrollViewer" Style="{DynamicResource {ComponentResourceKey ResourceId=MenuScrollViewer, TypeInTargetAssembly={x:Type FrameworkElement}}}">
                                            <ItemsPresenter x:Name="ItemsPresenter" KeyboardNavigation.DirectionalNavigation="Cycle" 
                                                          Grid.IsSharedSizeScope="True" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" 
                                                          KeyboardNavigation.TabNavigation="Cycle"/>
                                        </ScrollViewer>
                                    </Border>
                                </Popup>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasDropShadow" SourceName="PART_Popup" Value="True">
                                <Setter Property="Effect" TargetName="SubMenuBorder">
                                    <Setter.Value>
                                        <DropShadowEffect BlurRadius="10" Direction="270" ShadowDepth="3" Opacity="0.2"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="Role" Value="TopLevelHeader">
                                <Setter Property="Padding" Value="8,4,8,4"/>
                                <Setter Property="Placement" TargetName="PART_Popup" Value="Bottom"/>
                                <Setter Property="HorizontalAlignment" TargetName="ArrowPath" Value="Center"/>
                                <Setter Property="VerticalAlignment" TargetName="ArrowPath" Value="Center"/>
                                <Setter Property="Margin" TargetName="ArrowPath" Value="0,0,0,0"/>
                                <Setter Property="Data" TargetName="ArrowPath" Value="M 0,0 L 4,4 L 8,0 Z"/>
                            </Trigger>
                            <Trigger Property="Role" Value="TopLevelItem">
                                <Setter Property="Padding" Value="8,4,8,4"/>
                            </Trigger>
                            <Trigger Property="Role" Value="SubmenuHeader">
                                <Setter Property="Visibility" TargetName="ArrowPath" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource HighlightBrush}"/>
                            </Trigger>
                            <Trigger Property="IsSubmenuOpen" Value="True">
                                <Setter Property="Background" TargetName="templateRoot" Value="{StaticResource HighlightBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- Main Window with Custom Chrome -->
    <Border Background="{StaticResource WindowBackgroundBrush}" CornerRadius="15">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title Bar -->
            <Grid Grid.Row="0" Background="Transparent" Height="60" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- App Logo and Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="20,0,0,0" VerticalAlignment="Center">
                    <TextBlock x:Name="AppTitle" Text="INVOICE BALANCE REFRESHER" Style="{StaticResource AppTitle}"/>
                </StackPanel>

                <!-- Window Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,20,0">
                    <Button x:Name="MinimizeButton" Style="{StaticResource IconButton}" Content="—" Click="MinimizeButton_Click" 
                           ToolTip="Minimize" FontSize="14" Padding="0,0,0,5"/>
                    <Button x:Name="MaximizeButton" Style="{StaticResource IconButton}" Content="☐" Click="MaximizeButton_Click" 
                           ToolTip="Maximize" FontSize="16" Margin="5,0"/>
                    <Button x:Name="CloseButton" Style="{StaticResource IconButton}" Content="✕" Click="CloseButton_Click" 
                           ToolTip="Close" FontSize="14" Foreground="{StaticResource ErrorBrush}"/>
                </StackPanel>
            </Grid>

            <!-- Content Area -->
            <Grid Grid.Row="1" Margin="20,0,20,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Menu Bar -->
                <Grid Grid.Row="0" Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Main Menu -->
                    <Menu Grid.Column="0" Margin="0,5,0,10">
                        <MenuItem Header="File">
                            <MenuItem Header="Create Sample CSV" Click="GenerateSampleCSV_Click"/>
                            <Separator/>
                            <MenuItem Header="Save Logs" Click="SaveLogs_Click"/>
                            <Separator/>
                            <MenuItem Header="Exit" Click="Exit_Click"/>
                        </MenuItem>
                        <MenuItem Header="Tools">
                            <MenuItem Header="Manage Credentials" Click="ManageCredentials_Click"/>
                            <MenuItem Header="Rate Limiting Settings" Click="RateLimitSettings_Click"/>
                            <MenuItem Header="Maintenance Settings" Click="OpenMaintenanceSettings_Click"/>
                            <MenuItem Header="Run Maintenance" Click="RunMaintenanceButton_Click"/>
                        </MenuItem>
                        <MenuItem Header="Help">
                            <MenuItem Header="Documentation" Click="Documentation_Click"/>
                            <MenuItem Header="About" Click="About_Click"/>
                        </MenuItem>
                    </Menu>
                </Grid>

                <!-- Main Tab Control -->
                <TabControl Grid.Row="1" x:Name="MainTabControl">
                    <!-- Single Invoice Tab -->
                    <TabItem Header="Single Invoice">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Border Style="{StaticResource ModernCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- Card Title -->
                                    <TextBlock Grid.Row="0" Text="PROCESS SINGLE INVOICE" Style="{StaticResource SectionTitle}" 
                                               Margin="0,0,0,20"/>

                                    <!-- Form Grid -->
                                    <Grid Grid.Row="1" Margin="0,0,0,20">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="180"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Credentials Selection -->
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Credential Set" Style="{StaticResource FieldLabel}" 
                                                   Margin="0,0,0,5" VerticalAlignment="Bottom"/>
                                        <ComboBox Grid.Row="0" Grid.Column="1" x:Name="CredentialSetComboBox" DisplayMemberPath="Name"
                                                 Margin="0,0,10,10" SelectionChanged="CredentialSetComboBox_SelectionChanged"/>
                                        <Button Grid.Row="0" Grid.Column="2" Content="Manage" Width="100" Style="{StaticResource SecondaryButton}"
                                               Click="ManageCredentials_Click" Margin="0,0,0,10"/>

                                        <!-- Biller GUID -->
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Biller GUID" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2" x:Name="BillerGUID" Margin="0,0,0,10"/>

                                        <!-- Web Service Key -->
                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Web Service Key" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2" x:Name="WebServiceKey" Margin="0,0,0,10"/>

                                        <!-- Account Number -->
                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Account Number" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="3" Grid.Column="1" Grid.ColumnSpan="2" x:Name="AccountNumber" Margin="0,0,0,10"/>

                                        <!-- Invoice Number -->
                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="Invoice Number" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2" x:Name="InvoiceNumber" Margin="0,0,0,10"/>
                                    </Grid>

                                    <!-- Process Button and Results -->
                                    <Grid Grid.Row="2">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Process Button -->
                                        <Button Grid.Row="0" Content="PROCESS INVOICE" Style="{StaticResource ActionButton}" 
                                               Width="200" HorizontalAlignment="Left" Margin="0,0,0,20"
                                               Click="ProcessSingleInvoice_Click"/>

                                        <!-- Results Area -->
                                        <Border Grid.Row="1" Background="{StaticResource ConsoleBackgroundBrush}" 
                                               CornerRadius="12" MinHeight="200">
                                            <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="15">
                                                <TextBlock x:Name="SingleResult" TextWrapping="Wrap"/>
                                            </ScrollViewer>
                                        </Border>
                                    </Grid>
                                </Grid>
                            </Border>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Batch Processing Tab -->
                    <TabItem Header="Batch Processing">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Border Style="{StaticResource ModernCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- Card Title -->
                                    <TextBlock Grid.Row="0" Text="BATCH INVOICE PROCESSING" Style="{StaticResource SectionTitle}" 
                                               Margin="0,0,0,20"/>

                                    <Border Background="#E3F2FD" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <Path Data="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" 
  Fill="{StaticResource InfoBrush}" Width="18" Height="18" Margin="0,0,8,0" Stretch="Uniform" />
                                            <TextBlock TextWrapping="Wrap" Foreground="{StaticResource InfoBrush}">
<Run FontWeight="SemiBold">Note:</Run> Biller GUID and Web Service Key are set on the Single Invoice tab
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>

                                    <!-- Format Selection -->
                                    <Grid Grid.Row="1" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="CSV Format" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center" Margin="0,0,20,0"/>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal">
                                            <RadioButton x:Name="InvoiceOnlyFormat" Content="Invoice Numbers Only" IsChecked="True" 
                                                       Margin="0,0,20,0"/>
                                            <RadioButton x:Name="AccountInvoiceFormat" Content="Account Number, Invoice Number Format"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- File Selection -->
                                    <Grid Grid.Row="2" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0" Content="SELECT CSV FILE" Style="{StaticResource PrimaryButton}" 
                                               Width="180" Click="BrowseCSV_Click"/>
                                        <TextBlock Grid.Column="1" x:Name="CSVFilePath" Style="{StaticResource FieldLabel}" 
                                                  VerticalAlignment="Center" Margin="15,0,0,0" TextTrimming="CharacterEllipsis"/>
                                    </Grid>

                                    <!-- Warning Alert -->
                                    <Border Grid.Row="3" Background="#FFF8E1" CornerRadius="8" Padding="15" Margin="0,0,0,15">
                                        <StackPanel>
                                            <TextBlock FontWeight="SemiBold" Foreground="#F57C00" TextWrapping="Wrap">
                                                Warning: Each invoice in the batch will make a separate API call.
                                            </TextBlock>
                                            <StackPanel Margin="15,5,0,0">
                                                <TextBlock Foreground="#F57C00" Margin="0,2,0,2">• Consider API rate limits</TextBlock>
                                                <TextBlock Foreground="#F57C00" Margin="0,2,0,2">• Be aware of potential API usage costs</TextBlock>
                                                <TextBlock Foreground="#F57C00" Margin="0,2,0,2">• Large batches will take longer to process</TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>

                                    <!-- Process Button and Status -->
                                    <Grid Grid.Row="4" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Button Grid.Row="0" Grid.Column="0" Content="PROCESS CSV" Style="{StaticResource ActionButton}" 
                                               Width="180" Click="ProcessCSV_Click" Margin="0,0,0,10"/>

                                        <ProgressBar Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" x:Name="BatchProgress" Margin="0,5,0,5"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" x:Name="BatchStatus" Style="{StaticResource StatusText}" 
                                                  Margin="0,5,0,0"/>
                                    </Grid>

                                    <!-- Search and Results -->
                                    <Grid Grid.Row="5">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>

                                        <!-- Search Bar -->
                                        <Grid Grid.Row="0" Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="FILTER" Style="{StaticResource FieldLabel}" 
                                                      VerticalAlignment="Center" Margin="0,0,15,0"/>
                                            <TextBox Grid.Column="1" x:Name="BatchSearchBox" TextChanged="BatchSearchBox_TextChanged" 
                                                   Margin="0,0,10,0"/>
                                            <Button Grid.Column="2" Content="✕" Style="{StaticResource IconButton}" 
                                                  Click="ClearBatchSearch_Click" ToolTip="Clear Filter" Width="40" Height="40" 
                                                  VerticalAlignment="Top" Margin="0,0,10,0"/>
                                            <TextBlock Grid.Column="3" x:Name="BatchSearchResultsCount" Style="{StaticResource Caption}" 
                                                      VerticalAlignment="Center" MinWidth="60"/>
                                        </Grid>

                                        <!-- Results Area -->
                                        <!-- Results Area -->
                                        <Border Grid.Row="1" Background="{StaticResource ConsoleBackgroundBrush}" 
       CornerRadius="12" MinHeight="300" MaxHeight="500">
                                            <DockPanel LastChildFill="True">
                                                <TextBlock DockPanel.Dock="Top" Text="PROCESSING RESULTS" Style="{StaticResource CardTitle}" 
                 Margin="15,15,0,5"/>
                                                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                     HorizontalScrollBarVisibility="Auto" 
                     Margin="15"
                     Padding="0,0,0,10">
                                                    <TextBox x:Name="BatchResults" 
                   Background="Transparent" 
                   BorderThickness="0" 
                   IsReadOnly="True" 
                   TextWrapping="Wrap" 
                   AcceptsReturn="True"
                   Width="{Binding RelativeSource={RelativeSource AncestorType=ScrollViewer}, Path=ViewportWidth}"
                   MinHeight="250"
                   MaxHeight="10000"
                   VerticalAlignment="Stretch"
                   HorizontalAlignment="Stretch"
                   FontFamily="Consolas"
                   FontSize="12"
                   Padding="5">
                                                        <TextBox.Resources>
                                                            <Style TargetType="TextBox">
                                                                <Setter Property="Template">
                                                                    <Setter.Value>
                                                                        <ControlTemplate TargetType="TextBox">
                                                                            <ScrollViewer x:Name="PART_ContentHost" 
                                               VerticalScrollBarVisibility="Hidden" 
                                               HorizontalScrollBarVisibility="Hidden"
                                               Background="Transparent" 
                                               Padding="{TemplateBinding Padding}"/>
                                                                        </ControlTemplate>
                                                                    </Setter.Value>
                                                                </Setter>
                                                            </Style>
                                                        </TextBox.Resources>
                                                    </TextBox>
                                                </ScrollViewer>
                                            </DockPanel>
                                        </Border>

                                    </Grid>
                                </Grid>
                            </Border>
                        </ScrollViewer>
                    </TabItem>

                    

                    <!-- Customer Lookup Tab -->
                    <TabItem Header="Customer Lookup">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <Border Style="{StaticResource ModernCard}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- Card Title -->
                                    <TextBlock Grid.Row="0" Text="CUSTOMER RECORD LOOKUP" Style="{StaticResource SectionTitle}" 
                                               Margin="0,0,0,20"/>

                                    <Border Background="#E3F2FD" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <Path Data="M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" 
              Fill="{StaticResource InfoBrush}" Width="18" Height="18" Margin="0,0,8,0" Stretch="Uniform" />
                                            <TextBlock TextWrapping="Wrap" Foreground="{StaticResource InfoBrush}">
            <Run FontWeight="SemiBold">Note:</Run> Biller GUID and Web Service Key are set on the Single Invoice tab
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>

                                    <!-- Account Number Input -->
                                    <Grid Grid.Row="1" Margin="0,0,0,15">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="180"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Account Number" Style="{StaticResource FieldLabel}" 
                                                   VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" x:Name="CustomerAccountNumber"/>
                                    </Grid>

                                    <!-- Lookup Button -->
                                    <Button Grid.Row="2" Content="LOOKUP CUSTOMER" Style="{StaticResource ActionButton}" 
                                           Width="200" HorizontalAlignment="Left" Margin="0,0,0,20"
                                           Click="ProcessCustomerRecord_Click"/>

                                    <!-- Results Area -->
                                    <Border Grid.Row="3" Background="{StaticResource ConsoleBackgroundBrush}" 
                                           CornerRadius="12" MinHeight="350">
                                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="15">
                                            <TextBlock x:Name="CustomerResult" TextWrapping="Wrap"/>
                                        </ScrollViewer>
                                    </Border>
                                </Grid>
                            </Border>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Scheduler Tab -->
                    <TabItem Header="Scheduler" x:Name="SchedulerTab">
                        <Border Style="{StaticResource ModernCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Card Title -->
                                <TextBlock Grid.Row="0" Text="SCHEDULED TASKS" Style="{StaticResource SectionTitle}" 
                                           Margin="0,0,0,20"/>

                                <!-- DataGrid -->
                                <DataGrid Grid.Row="1" x:Name="ScheduledTasksGrid" Margin="0,0,0,20" 
                                         HeadersVisibility="Column" IsReadOnly="True" SelectionMode="Single">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150"/>
                                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="200"/>
                                        <DataGridTextColumn Header="Frequency" Binding="{Binding Frequency}" Width="100"/>
                                        <DataGridTextColumn Header="Next Run Time" Binding="{Binding NextRunTime, StringFormat=MM/dd/yyyy hh:mm tt}" Width="150"/>
                                        <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding IsEnabled}" Width="70"/>
                                        <DataGridTextColumn Header="Last Run" Binding="{Binding LastRunTime, StringFormat=MM/dd/yyyy hh:mm tt}" Width="150"/>
                                        <DataGridTextColumn Header="Last Result" Binding="{Binding LastRunResult}" Width="*"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button x:Name="AddButton" Content="ADD NEW" Style="{StaticResource SecondaryButton}" 
                                           Width="120" Height="40" Margin="0,0,10,0" Click="AddSchedule"/>
                                    <Button x:Name="EditButton" Content="EDIT" Style="{StaticResource SecondaryButton}" 
                                           Width="120" Height="40" Margin="0,0,10,0" Click="EditSchedule"/>
                                    <Button x:Name="DeleteButton" Content="DELETE" Style="{StaticResource SecondaryButton}" 
                                           Width="120" Height="40" Margin="0,0,10,0" Click="DeleteSchedule"/>
                                    <Button x:Name="RunNowButton" Content="RUN NOW" Style="{StaticResource ActionButton}" 
                                           Width="120" Height="40" Click="RunNowScheduledTask"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </TabItem>
                </TabControl>
            </Grid>

            <!-- Console Log Section -->
            <Border Grid.Row="2" Style="{StaticResource ModernCard}" Background="{StaticResource ConsoleBackgroundBrush}" Margin="20,0,20,20">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Console Header with Search -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="CONSOLE LOG" Style="{StaticResource CardTitle}" 
                                   Foreground="{StaticResource PrimaryBrush}" VerticalAlignment="Center" Margin="0,0,20,0"/>

                        <Grid Grid.Column="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="SEARCH" Style="{StaticResource FieldLabel}" 
                                      VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <TextBox Grid.Column="1" x:Name="SearchBox" Height="39" TextChanged="SearchBox_TextChanged" Margin="0,0,10,0"/>
                            <Button Grid.Column="2" Content="✕" Style="{StaticResource IconButton}" Click="ClearSearch_Click" 
                                   ToolTip="Clear Search" Width="35" Height="39"/>
                        </Grid>

                        <TextBlock Grid.Column="2" x:Name="SearchResultsCount" Style="{StaticResource Caption}" 
                                   VerticalAlignment="Center" Margin="0,0,20,0"/>

                        <StackPanel Grid.Column="3" Orientation="Horizontal">
                            <Button Content="Clear" Style="{StaticResource SecondaryButton}" Click="ClearLog_Click" 
                                   Margin="0,0,10,0" Width="80" Height="39"/>
                            <Button Content="Save Logs" Style="{StaticResource SecondaryButton}" Click="SaveLogs_Click" 
                                   Width="100" Height="39"/>
                        </StackPanel>
                    </Grid>

                    <!-- Console Log Area -->
                    <RichTextBox Grid.Row="1" x:Name="ConsoleLog" Height="150">
                        <RichTextBox.Resources>
                            <Style TargetType="{x:Type Paragraph}">
                                <Setter Property="Margin" Value="0"/>
                            </Style>
                        </RichTextBox.Resources>
                        <FlowDocument>
                            <Paragraph>
                                <Run Foreground="{StaticResource InfoBrush}" FontWeight="Bold">Welcome to Invoice Balance Refresher!</Run>
                            </Paragraph>
                            <Paragraph>
                                <Run>Log messages and operation status will appear here.</Run>
                            </Paragraph>
                        </FlowDocument>
                    </RichTextBox>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>   